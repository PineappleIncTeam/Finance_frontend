# Инструкция по глобальному и локальному обработчику ошибок

Этот документ описывает, как обрабатываются ошибки в приложении, включая глобальные механизмы обработки ошибок и локальные компоненты, такие как модальные окна для асинхронных функций и ошибок HTTP-ответов.

## 1. Глобальный обработчик ошибок

Глобальная обработка ошибок в приложении осуществляется с помощью следующих компонентов:

### 1.1. `Хук useGlobalErrorHandler`
`src/hooks/useGlobalErrorHandler.ts`

Этот хук отвечает за перехват необработанных исключений и отклоненных промисов на уровне браузера.

*   **Механизм**: Устанавливает слушатели событий для `window.onerror` и `window.onunhandledrejection`.
*   **Интеграции**: Ошибки отправляются в Sentry для мониторинга с помощью функции `sendErrorToMonitoring` в production режиме.

### 1.2. `Компонент ErrorPage`
`src/app/error.tsx` 

Этот компонент является страницей ошибок Next.js, которая отображается, когда возникает глобальная ошибка.

*   **Пользовательский интерфейс**: Предоставляет интерфейс для отображения информации об ошибке.
*   **Действия пользователя**: Включает кнопки для:
    *   `Попробовать снова`: Сбрасывает состояние ошибки.
    *   `На главную`: Перенаправляет пользователя на главную страницу.
    *   `Сообщить об ошибке`: Открывает почтовый клиент с предварительно заполненным письмом для сообщения об ошибке.
*   **Интеграции**: Использует Sentry для захвата исключений, обеспечивая мониторинг ошибок даже на уровне пользовательского интерфейса.
*   **Режим разработки**: В режиме разработки отображает подробную трассировку стека ошибки для отладки.

### 1.3. `Компонент PrivateRouteErrorModal`
`src/components/mainLayout/errorHandlerElements/privateRouteErrorModal/privateRouteErrorModal.tsx`

Этот компонент представляет собой модальное окно, которое появляется при ошибке авторизации, в частности, для приватных маршрутов. Он информирует пользователя о том, что для доступа к приложению требуется авторизация.

## 2. Локальные обработчики ошибок

Помимо глобальной обработки, приложение использует локальные механизмы для обработки конкретных типов ошибок, часто с использованием модальных окон для информирования пользователя.

### 2.1. Обработка асинхронных ошибок

#### 2.1.1. `Хук useHandleAsyncError`
`src/hooks/useHandleAsyncError.ts`

Этот хук предоставляет функциональность для обработки ошибок, возникающих в асинхронных функциях.

*   **`withErrorHandling`**: Функция высшего порядка, которая оборачивает асинхронные функции в блок `try...catch`.
*   **`handleAsyncError`**: Вызывается при возникновении ошибки в асинхронной функции.
    *   **Режим разработки**: Открывает модальное окно асинхронной ошибки (`AsyncErrorModal`) для отображения деталей ошибки.
    *   **Производственная среда**: Отправляет ошибку в Sentry через `sendErrorToMonitoring`.

#### 2.1.2. `Компонент AsyncErrorModal`
`src/components/mainLayout/errorHandlerElements/asyncErrorModal/asyncErrorModal.tsx`

Этот компонент представляет собой модальное окно, которое отображается в режиме разработки при возникновении асинхронной ошибки.

*   **Источник данных**: Получает информацию об ошибке из `useAsyncErrorModal` (который, вероятно, управляется `asyncErrorProvider.tsx`).
*   **Содержимое**: Отображает сообщение об ошибке и трассировку стека (в режиме разработки).
*   **Взаимодействие**: Предоставляет кнопку для закрытия модального окна.
*   **Область применения**: Приложение обёрнуто в провайдер asyncErrorProvider, поэтому область применения - всё приложение.
`src/components/mainLayout/errorHandlerElements/asyncErrorModal/asyncErrorProvider.tsx`

### 2.2. Обработка ошибок API

#### 2.2.1. `Хук useApiErrorModal`
`src/hooks/useApiErrorModal.ts`

Этот хук управляет состоянием модального окна ошибки API.

*   **Состояние**: Управляет видимостью, заголовком, сообщением и типом ошибки модального окна.
*   **`showError`**: Функция для отображения модального окна, принимающая `errorType` (код состояния HTTP, например, "403", "500") и необязательное пользовательское сообщение. Она настраивает содержимое модального окна на основе предопределенной конфигурации ошибок.
*   **`hideError`**: Функция для скрытия модального окна.
*   **Область применения**: Приложение обёрнуто в провайдер apiErrorProvider, поэтому область применения - всё приложение.
`src/components/mainLayout/errorHandlerElements/apiErrorModal/apiErrorProvider.tsx`

#### 2.2.2. `Компонент ApiErrorModal`
`src/components/mainLayout/errorHandlerElements/apiErrorModal/apiErrorModal.tsx`

Этот компонент представляет собой модальное окно, которое отображается при возникновении ошибок API.

*   **Источник данных**: Получает `modalState` (состояние модального окна) и функцию `onClose` в качестве пропсов.
*   **Содержимое**: Отображает заголовок и сообщение об ошибке, специфичные для типа ошибки API.
*   **Действия пользователя**: В зависимости от `errorType` (кода состояния HTTP) отображает различные кнопки действий, такие как «На главную» или «Перезагрузить страницу», чтобы помочь пользователю решить проблему.

### 2.3. Обработка сетевых ошибок клиента

#### 2.3.1. `Компонент ClientNetworkErrorModal`
`src/components/mainLayout/errorHandlerElements/clientNetworkErrorModal/clientNetworkErrorModal.tsx`

Этот компонент представляет собой модальное окно, которое отображает сетевые ошибки на стороне клиента. Он получает детали ошибки из `useClientNetworkErrorModal`. Он показывает сообщение об ошибке и, если доступно, трассировку стека. Это выделенный локальный обработчик ошибок для проблем, связанных с сетью.

#### 2.3.2. `Компонент ClientNetworkErrorModalProvider`
`src/components/mainLayout/errorHandlerElements/clientNetworkErrorModal/clientNetworkErrorModalProvider.tsx`

Этот провайдер использует React Context для предоставления состояния и функций модального окна ошибок соответствующему хуку (`useClientNetworkErrorModal`). Он управляет видимостью модального окна и объектом ошибки.

### 2.4. Обработка серверных ошибок приложения

#### 2.4.1. `Страница ServerErrorPage`
`src/app/(home)/serverError/page.tsx`

Этот компонент представляет собой отдельную страницу, которая отображает информационное сообщение о серверной ошибке на стороне клиента.

## 3. Другие компоненты, связанные с обработкой ошибок

*   **`src/components/mainLayout/errorHandlerElements/errorHandler/errorHandler.tsx`**: Общий компонент-обертка для обработки ошибок.
